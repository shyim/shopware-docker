pool:
  vmImage: 'ubuntu-latest'

strategy:
  matrix:
    cli:
      MODULE: "cli"
    nginx:
      MODULE: "nginx"
    xdebug:
      MODULE: "xdebug"
    mysql:
      MODULE: "mysql"
    blackfire:
      MODULE: "blackfire"

steps:
- task: NodeTool@0 
  inputs:
    versionSpec: '12.x'

- script: |
    cd images/
    npm install twig
    ./generate.sh
    ./build.sh ${MODULE}
  displayName: 'Build image and push'

- task: Docker@2
  condition: and(always(), eq('$MODULE', 'mysql'))
  inputs:
    containerRegistry: 'Docker Hub'
    repository: 'shyim/shopware-mysql'
    command: 'push'
    tags: |
      55
      56
      57
      8
